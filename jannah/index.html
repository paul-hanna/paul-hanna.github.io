<!DOCTYPE html>
<!--Waiting, Leaving by Paul Hanna-->

<script async src="https://www.googletagmanager.com/gtag/js?id=G-S0QT9MG3YC"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-S0QT9MG3YC');
  </script>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>an excerpt from</title>

  <title>JANNAH</title>
  <title>a pilot by Paul Hanna</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
    }
    body.locked {
      overflow: hidden;
    }
    body.unlocked {
      overflow-y: auto;
    }
    html, body, * {
      user-select: none;
    }

    .script-container {
      font-family: "Courier New", monospace;
      font-size: 18px;
      max-width: 80%;
      margin: 40px auto;
      padding: 10px;
      line-height: 1.2;
      white-space: pre-line;
    }
    .script-line {
      visibility: hidden;
      margin: 0 0 20px;  
      padding: 0;
      text-align: center;
    }
    .script-line.visible {
      visibility: visible;
    }
    .script-line.action {
      text-align: left;
      margin-bottom: 20px;
    }
    .scene-heading {
      text-align: left;
      font-weight: bold;
      margin-bottom: 20px;
      text-transform: uppercase;
    }
    .character {
      margin: 0;
      padding: 0;
      line-height: 1;
      font-weight: bold;
      text-align: center;
      cursor: default;
    }
    .character.clickable {
      text-decoration: underline dotted;
      cursor: pointer;
      color: rgb(0, 0, 197);
    }



    .dialogue {
      margin: 0 auto 20px;
      padding: 0;
      line-height: 1.4;
      text-align: left;
      max-width: 60ch;
      
    }
    .faded {
      opacity: 50%;
    }
    .cursor {
      display: inline-block;
      width: 1ch;
      animation: blink 1.5s step-start infinite;
    }
    @keyframes blink {
      50% { opacity: 0; }
    }

    .title-screen {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: "Courier New", monospace;
      font-size: 32px;
      text-align: center;
      cursor: pointer;
    }

    /* Film strip overlay */
    .sequence {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80vmin;
      height: 80vmin;
      overflow: hidden;
      z-index: 100;
      background: transparent;
    }
    .image-layer {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
    }
    .image-layer img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }
    .image-layer.visible {
      opacity: 1;
      z-index: 10;
    }
    .image-layer.previous {
      opacity: 0.15;
      z-index: 1;
    }

    /* Scroll-wheel video overlay */
    .video-sequence {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      overflow: hidden;
      z-index: 100;
      background: transparent;
      display: flex;
      flex-direction: column;
    }
    .scroll-hint {
      position: absolute;
      top: 10px;
      width: 100%;
      text-align: center;
      color: #000;
      font-family: "Courier New", monospace;
      font-size: 16px;
      pointer-events: none;
      background-color: white;
    }
    .scroll-hint::after {
      content: "▼";
      display: block;
      margin-top: 4px;
      animation: moveDown infinite alternate;
      background-color: white;
    }
    @keyframes moveDown {
      from { transform: translateY(0); }
      to { transform: translateY(8px); }
    }
    .video-wrapper {
      width: 100%;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      pointer-events: none;
    }
    .video-wrapper video {
      max-width: 80%;
      max-height: 80%;
      object-fit: contain;
      background: transparent;
    }

    .trigger-word {
      text-decoration: underline dotted;
      cursor: pointer;
      color: rgb(0, 0, 197);
    }
    @media (max-width: 768px) {
      .character.clickable {
        text-decoration: underline solid;
      }
      .trigger.word {
        text-decoration: underline solid;
      }
    }
    .trigger-word.clicked,
    .character.clickable.clicked {
      cursor: default;
      text-decoration: none;
      color: inherit;
    }
  </style>
</head>
<body class="locked">
  <audio id="bg-audio" src="audio/waitingleaving.mp3" autoplay muted loop></audio>
  <div id="title-screen" class="title-screen">an excerpt from <br><br>
    JANNAH<br><br>
    a pilot by Paul Hanna
  </div>
  <div id="main-container" style="display: none; position: relative;"></div>
  <div id="script-sequence" class="script-container" style="display: none;">
    <div class="script-line scene-heading">INT. BASEMENT - DARK, OMINOUS, REEKS OF MILDEW. </div>
    <div class="script-line action" data-sound="audio/connect-tone.mp3">
      Sami opens the basement door and slowly creeps his way downstairs. </div>
    <div class="script-line action">There’s a certain tension in the air--a feeling that he’s being watched, exacerbated by the fact that he can’t really see much.</div>
    <div class="script-line action">He stumbles a bit on the last step, on a little inconsistency between the step height and where he expects the floor to be.</div>  
    <div class="script-line action">In front of him, there’s a SINGULAR LIGHTBULB with a STRING hanging. Sami reaches for the string and pulls it.</div>  
    <div class="script-line action">The space illuminates.</div>  
    <div class="script-line action">The basement is substantially smaller than expected now that we can see it all.</div>  
    <div class="script-line action">A SINGULAR BOX stands out from the crowd of other boxes.</div>  
    <div class="script-line action">Sami slowly makes his way towards the box, crouches down, and opens it up. There are books, loose papers, envelopes, tax documents, fliers, the whole shebang. It’s mostly a mound of trash, but Sami digs through the box <i>just in case.</i></div>  
    <div class="script-line action">Sami finds a journal ridden with illegible text that intrigues him and flips to some page. He sees a PHOTO of his grandfather, smiling and wearing a beret in a theatre. He pulls the photo out of the journal and holds onto it.</div>  
    <div class="script-line action">A beat.</div>  
    <div class="script-line action">The light flickers and the room somehow feels even smaller now. Sami turns around to look at the light. </div>  
    <div class="script-line action" data-delay="400">SUDDENLY--</div>  
    <div class="script-line action" data-delay="400">the room goes dark.</div>  
    <div class="script-line action">A beat.</div>  
    <div class="script-line action">There’s a LOUD SOUND--a pipe pushing some water and a water hammer. A few loud bangs. </div>  
    <div class="script-line action">It’s a cacophony of everything below: the sewers, the deep resonances of the earth, perhaps mole people fixing things with hammers.</div>  
    <div class="script-line action">Sami takes some deep breaths.</div>  
    <div class="script-line action">The light comes back on. Relief.</div>  
    <div class="script-line action">A beat.</div>  
    <div class="script-line action">Sami turns around to resume sifting through the box, when suddenly--</div>  
    <div class="script-line action">JIDO is standing right behind the box, wearing the same 60s business casual, this time, carrying a MANUSCRIPT.</div>  
    <div class="script-line action">He stares straight into Sami’s soul. Sami cannot believe his eyes.</div>  
    <div class="script-line character clickable">SAMI</div>
    <div class="script-line dialogue" data-type="you-dialogue">Jido?</div> 
    <div class="script-line action">Jido kicks the box over. Its contents spill out.</div>  
    <div class="script-line action">He tosses the manuscript at Sami:</div>  
    <div class="script-line action"><b>WUST EL-BALAD. A PLAY IN TWO ACTS.</b></div>  
    <div class="script-line action">It lands in front of him. Sami leans down to pick it up--when he’s upright again, Jido has disappeared.</div>  
    <div class="script-line action">Sami sits on the floor, alone, and stares at the manuscript.</div>  
    <div class="script-line action">He opens the cover to the first page, and sees a photo of his late grandfather in Detroit in the 60s, wearing the exact same outfit he was just wearing. Sami’s eyes glow with intention as he thumbs through the other pages.</div>  



    <div class="script-line character clickable" id="the-end" data-delay="5000"><b><u>END</u></b></div>
  </div>
  <script>
    const sequenceConfig = [
      { frames: 5, path: 'sequences/sequence1', ext: 'jpg' },
      { frames: 4, path: 'sequences/sequence2', ext: 'jpg' },
      { frames: 5, path: 'sequences/sequence3', ext: 'jpg' },
      { frames: 5, path: 'sequences/sequence4', ext: 'jpg' },
      { frames: 5, path: 'sequences/sequence5', ext: 'jpg' },
      { frames: 8, path: 'sequences/sequence6', ext: 'jpg' },
      { frames: 6, path: 'sequences/sequence7', ext: 'jpg' },
      { frames: 5, path: 'sequences/sequence8', ext: 'jpg' },
      { frames: 8, path: 'sequences/sequence9', ext: 'jpg' },
      { frames: 7, path: 'sequences/sequence10', ext: 'jpg' },
      { frames: 7, path: 'sequences/sequence11', ext: 'jpg' },
      { frames: 5, path: 'sequences/sequence12', ext: 'jpg' },
      { frames: 7, path: 'sequences/sequence13', ext: 'jpg' },
      { frames: 5, path: 'sequences/sequence14', ext: 'jpg' },
      { frames: 5, path: 'sequences/sequence15', ext: 'jpg' },
      { frames: 4, path: 'sequences/sequence16', ext: 'jpg' }
    ];

    function preloadAllImages(sequenceConfig) {
      const loadPromises = [];

      sequenceConfig.forEach(seq => {
        // only handle image‑based sequences
        if (seq.frames && seq.path && seq.ext) {
          for (let i = 1; i <= seq.frames; i++) {
            const img = new Image();
            const filename = String(i).padStart(3, '0');
            img.src = `${seq.path}/${filename}.${seq.ext}`;
            
            // wrap each load/error in a promise
            loadPromises.push(new Promise(resolve => {
              img.onload  = () => resolve();
              img.onerror = () => resolve();  // resolve even on error
            }));
          }
        }
      });

      // return a single promise that resolves when all frames are done
      return Promise.all(loadPromises).then(() => {});
    }

    // Usage example: call this before you ever play any film‑strip
    preloadAllImages(sequenceConfig).then(() => {
      console.log('all loaded 8)');
    });

    let currentSceneAudio = null;

    const DEFAULT_DELAY = 2000;
    const ACTION_DELAY  = 3000;
    const DEFAULT_TYPING_SPEED = 75;
    const IMAGE_FRAME_DURATION = 800;   // time between frames
    const IMAGE_HOLD_DURATION  = 1000;   // pause after the last frame


    if ('scrollRestoration' in history) {
      history.scrollRestoration = 'manual';
    }
    window.scrollTo(0, 0);
    ['beforeunload', 'DOMContentLoaded'].forEach(evt => {
      window.addEventListener(evt, () => {
        setTimeout(() => window.scrollTo(0, 0), 10);
      });
    });

    const bgAudio = document.getElementById('bg-audio');
    bgAudio.play().catch(() => {});
    document.addEventListener('click', () => {
      if (bgAudio.muted) {
        bgAudio.muted = false;
        bgAudio.play();
      }
    }, { once: true });

    document.getElementById('title-screen').onclick = () => {
      document.getElementById('title-screen').style.display = 'none';
      document.getElementById('main-container').style.display = 'block';
      document.getElementById('script-sequence').style.display = 'block';
      setupScriptSequence();
    };

function shuffleScenes() {
  const container = document.getElementById('script-sequence');
  const children  = Array.from(container.children);

  // find the indices of every scene-heading
  const sceneStops = children
    .map((el,i) => el.classList.contains('scene-heading') ? i : -1)
    .filter(i => i > -1);

  // slice into segments [ [scene1…], [scene2…], … ]
  const segments = sceneStops.map((start, idx) => {
    const end = (sceneStops[idx+1] != null ? sceneStops[idx+1] : children.length);
    return children.slice(start, end);
  });

  // only shuffle if there are > 2 segments
  if (segments.length > 2) {
    const first = segments.shift();
    const last  = segments.pop();

    // Fisher–Yates
    for (let i = segments.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [segments[i], segments[j]] = [segments[j], segments[i]];
    }

    // rebuild
    container.innerHTML = '';
    [first, ...segments, last]
      .flat()
      .forEach(el => container.appendChild(el));
  }
}

    function setupScriptSequence() {
     // shuffleScenes();  
      const lines = Array.from(document.querySelectorAll('.script-line'));

      function show(index) {
        if (index >= lines.length) return;
        const line = lines[index];
        if (line.classList.contains('scene-heading')) {
        // stop any previous ambient
        if (currentSceneAudio) {
          currentSceneAudio.pause();
          currentSceneAudio.currentTime = 0;
        }
        // start the new one (if declared)
        if (line.dataset.sceneSound) {
          currentSceneAudio = new Audio(line.dataset.sceneSound);
          currentSceneAudio.loop = true;
          currentSceneAudio.volume = 0.2;
          currentSceneAudio.play();
        } else {
          currentSceneAudio = null;
        }
      }
        if (line.dataset.sound) {
          const cue = new Audio(line.dataset.sound);
          cue.volume = 0.3;
          cue.play();
        }
        line.classList.add('visible');
        line.scrollIntoView({ behavior: 'smooth', block: 'center' });

        if (line.id === 'the-end') {
          line.addEventListener('click', playEndVideo);
          return;
        }

        if (line.classList.contains('action')) {
          const trigger = line.querySelector('.trigger-word');
          if (trigger) {
            const handler = () => {
              trigger.removeEventListener('click', handler);
              trigger.classList.add('clicked');
              const seq = sequenceConfig[+trigger.dataset.sequence];
              if (seq.type === 'video') {
                playVideoSequence(seq, () => show(index + 1));
              } else {
                playFilmStrip(+trigger.dataset.sequence, () => show(index + 1));
              }
            };
            trigger.addEventListener('click', handler);
            return;
          }
        }

        if (line.classList.contains('clickable')) {
          const clickHandler = () => {
            line.removeEventListener('click', clickHandler);
            line.classList.add('clicked');
            const nextLine = lines[index + 1];
            if (nextLine.dataset.type === 'you-dialogue') {
              typeText(nextLine, () => show(index + 2));
            } else {
              show(index + 1);
            }
          };
          line.addEventListener('click', clickHandler);
          return;
        }

          let delayMs = DEFAULT_DELAY;

          if (line.dataset.delay) {
            delayMs = parseInt(line.dataset.delay, 10);

          } else if (line.classList.contains('action')) {
            delayMs = ACTION_DELAY;
          }

          setTimeout(() => show(index + 1), delayMs);
      }

      show(0);
    }

    function typeText(element, callback) {
  element.classList.add('visible');

  const text = element.textContent;
  element.textContent = '';

  // determine per-character delay
  const speed = element.dataset.speed
    ? parseInt(element.dataset.speed, 10)
    : DEFAULT_TYPING_SPEED; 

  const cursor = document.createElement('span');
  cursor.className = 'cursor';
  cursor.textContent = '|';
  element.appendChild(cursor);

  let i = 0;
  function typeChar() {
    if (i < text.length) {
      element.insertBefore(
        document.createTextNode(text[i++]),
        cursor
      );
      setTimeout(typeChar, speed);
    } else {
      cursor.remove();
      callback();
    }
  }
  typeChar();
}


function playFilmStrip(index, done) {
  const config    = sequenceConfig[index];
  const container = document.getElementById('main-container');
  const strip     = document.createElement('div');
  strip.className = 'sequence';
  container.appendChild(strip);

  const layers = [];
  for (let i = 0; i < config.frames; i++) {
    const layer = document.createElement('div');
    layer.className = 'image-layer';
    const img = document.createElement('img');
    img.src = `${config.path}/${String(i+1).padStart(3,'0')}.${config.ext}`;
    layer.appendChild(img);
    strip.appendChild(layer);
    layers.push(layer);
  }

  let current = 0;
  function nextFrame() {
    layers.forEach((l, idx) => {
      l.style.opacity = idx < current ? 0.15
                       : idx === current ? 1
                       : 0;
    });
    current++;

    if (current < layers.length) {
      setTimeout(nextFrame, IMAGE_FRAME_DURATION);
    } else {
      setTimeout(() => {
        container.removeChild(strip);
        done();
      }, IMAGE_HOLD_DURATION);
    }
  }

  nextFrame();
}


    function playVideoSequence(seqConfig, done) {
      const container = document.getElementById('main-container');
      const vs = document.createElement('div');
      vs.className = 'video-sequence';

      const hint = document.createElement('div');
      hint.className = 'scroll-hint';
      hint.textContent = 'Use scroll wheel to play';
      vs.appendChild(hint);

      const wrapper = document.createElement('div');
      wrapper.className = 'video-wrapper';
      const video = document.createElement('video');
      video.src = seqConfig.src;
      video.muted = true;
      video.preload = 'auto';
      wrapper.appendChild(video);
      vs.appendChild(wrapper);

      container.appendChild(vs);
      video.currentTime = 0;

      const wheelHandler = e => {
        e.preventDefault();
        const delta = e.deltaY > 0 ? 1/30 : -1/30;
        video.currentTime = Math.min(
          seqConfig.duration,
          Math.max(0, video.currentTime + delta)
        );
        if (video.currentTime >= seqConfig.duration) {
          vs.removeEventListener('wheel', wheelHandler);
          container.removeChild(vs);
          done();
        }
      };
      vs.addEventListener('wheel', wheelHandler, { passive: false });
    }

    function playEndVideo() {
  // create video element
  const endVideo = document.createElement('video');
  endVideo.src         = 'sequences/end.mp4';
  endVideo.autoplay    = true;
  endVideo.loop        = false;            
  endVideo.playsInline = true;          
  endVideo.muted       = true;            
  endVideo.preload     = 'auto';           
  endVideo.controls    = false;        

  // style to fill screen
  Object.assign(endVideo.style, {
    position:   'fixed',
    top:        '0',
    left:       '0',
    width:      '100%',
    height:     '100%',
    objectFit:  'cover',
    background: 'transparent',             
    zIndex:     9999
  });

  document.body.appendChild(endVideo);

  // when it ends, jump back to 0 and play immediately
  endVideo.addEventListener('ended', () => {
    endVideo.currentTime = 0;
    endVideo.play();
  });
}

  </script>
</body>
</html>